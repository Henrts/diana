import { Meta, Story, Preview } from "@storybook/addon-docs/blocks";
import {
  PortalStory,
  TopPortalStory,
  RightPortalStory,
  LeftPortalStory,
  CenteredPortalStory,
  BottomRightPortalStory,
  TopRightPortalStory,
  CenterTopPortalStory,
  OverflowPortalStory
} from "./Portal.story.tsx";

<Meta title="Components | Portal" />

# Portal

The Portal component uses <a href="https://reactjs.org/docs/portals.html">React Portals</a> to render
a DOM element outside the DOM hierarchy of the parent element, namely as a child of the `<body>`.

This component was implemented for the `Popover` to be able to visibly overflow out of parents that have `overflow-hidden`.
An example of this can be found when a `Dropdown` (that used the `Popover`) is rendered inside a `Modal`.

<Preview>
  <Story name="Portal">
    <PortalStory />
  </Story>
</Preview>

The `Portal` is absolutely positioned, and its position can be determined through the `direction` prop.
To calculate that position, the parent element's position is used via the `parentRef` prop.

<Preview>
  <Story name="TopPortal">
    <TopPortalStory />
  </Story>
</Preview>

<Preview>
  <Story name="RightPortal">
    <RightPortalStory />
  </Story>
</Preview>

<Preview>
  <Story name="LeftPortal">
    <LeftPortalStory />
  </Story>
</Preview>

<Preview>
  <Story name="CenteredPortal">
    <CenteredPortalStory />
  </Story>
</Preview>

<Preview>
  <Story name="BottomRight">
    <BottomRightPortalStory />
  </Story>
</Preview>

<Preview>
  <Story name="TopRight">
    <TopRightPortalStory />
  </Story>
</Preview>

<Preview>
  <Story name="Center">
    <CenterTopPortalStory />
  </Story>
</Preview>

### Repositioning partially hidden Portals

If the element were to be rendered (partially) outside the viewport, a new direction will be chosen and the Portal's position will be recalculated until either
the element is not outside the viewport or the element is outside the viewport no matter the direction.
In the latter case, the original direction is used.

Vertical clipping of the Portal is not taken into account for repositioning purposes, as it represents a more complex problem due to how common vertical scrolling
is. This can be revisited in the future.

<Preview>
  <Story name="Partially hidden">
    <OverflowPortalStory />
  </Story>
</Preview>

### Available props

<table width="100%">
  <thead>
    <tr>
      <th>Prop Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>centered (optional)</td>
      <td>boolean</td>
      <td>Whether portal is centered with its parent element</td>
    </tr>
    <tr>
      <td>direction (optional)</td>
      <td>"bottom" (default) | "left" | "right" | "top" | "bottom-right" | "top-right"</td>
      <td>Where to place the portal relative to the parent element</td>
    </tr>
    <tr>
      <td>parentRef</td>
      <td>{"React.RefObject<HTMLDivElement>"}</td>
      <td>The parent element's ref</td>
    </tr>
    <tr>
      <td>useParentWidth (optional)</td>
      <td>boolean</td>
      <td>Whether to set portal's width to its parent element's width</td>
    </tr>
    <tr>
      <td>scrollableRootElement (optional)</td>
      <td>boolean</td>
      <td>
        Necessary for recalculating position if scrollable root element scrolls. "root" by default
      </td>
    </tr>
  </tbody>
</table>
